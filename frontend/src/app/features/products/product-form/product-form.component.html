<div class="product-form-wrapper">
  <div class="header flex justify-content-between align-items-center mb-4">
    <h1>{{ isEdit ? 'Modifier produit' : 'Nouveau produit' }}</h1>
  </div>

  <p-card>
    <div class="dialog-body">
      <div class="field">
        <label class="field-label">Nom</label>
        <input pInputText [(ngModel)]="productForm.name" class="w-full" />
      </div>

      <div class="field">
        <label class="field-label">Description</label>
        <input pInputText [(ngModel)]="productForm.description" class="w-full" />
      </div>

      <div class="grid">
        <div class="col-12 md:col-4">
          <label class="field-label">Prix</label>
          <input pInputText [(ngModel)]="productForm.price" type="number" class="w-full" />
        </div>
        <div class="col-12 md:col-4">
          <label class="field-label">Prix original</label>
          <input pInputText [(ngModel)]="productForm.originalPrice" type="number" class="w-full" />
        </div>
        <div class="col-12 md:col-4">
          <label class="field-label">Remise (%)</label>
          <input pInputText [(ngModel)]="productForm.discount" type="number" class="w-full" />
        </div>
      </div>

      <div class="grid">
        <div class="col-12 md:col-6">
          <label class="field-label">Catégorie</label>
          <p-select
            [options]="categories"
            optionLabel="displayName"
            optionValue="_id"
            [(ngModel)]="productForm.category"
            placeholder="Sélectionner"
            styleClass="w-full">
          </p-select>
        </div>
        <div class="col-12 md:col-3">
          <label class="field-label">Promotion</label>
          <p-select
            [options]="promotionOptions"
            optionLabel="label"
            optionValue="value"
            [(ngModel)]="productForm.isPromotion"
            styleClass="w-full">
          </p-select>
        </div>
        <div class="col-12 md:col-3">
          <label class="field-label">Statut</label>
          <p-select
            [options]="activeOptions"
            optionLabel="label"
            optionValue="value"
            [(ngModel)]="productForm.isActive"
            styleClass="w-full">
          </p-select>
        </div>
      </div>

      <div class="grid">
        <div class="col-12 md:col-6">
          <label class="field-label">Quantité en stock</label>
          <input pInputText [(ngModel)]="productForm.stockQuantity" type="number" class="w-full" />
        </div>
        <div class="col-12 md:col-6">
          <label class="field-label">Seuil stock bas</label>
          <input pInputText [(ngModel)]="productForm.lowStockAlert" type="number" class="w-full" />
        </div>
      </div>

      <div class="field">
        <label class="field-label">Images (max 5)</label>
        <input type="file" multiple accept="image/*" (change)="onFilesSelected($event)" />
        <div class="preview-list" *ngIf="previewUrls.length">
          <img *ngFor="let url of previewUrls" [src]="url" alt="preview" />
        </div>
      </div>
    </div>

    <ng-template pTemplate="footer">
      <p-button label="Annuler" severity="secondary" (onClick)="cancel()"></p-button>
      <p-button label="Enregistrer" (onClick)="saveProduct()" [loading]="loading"></p-button>
    </ng-template>
  </p-card>
</div>

<p-toast></p-toast>
