<div class="categories-wrapper">
  <div class="header flex justify-content-between align-items-center mb-4">
    <h1>Catégories</h1>
    <div class="actions">
      <p-button label="Nouvelle catégorie" icon="pi pi-plus" (onClick)="openNew()"></p-button>
    </div>
  </div>

  <p-card>
    <p-table [value]="categories" [loading]="loading">
      <ng-template pTemplate="header">
        <tr>
          <th>Nom</th>
          <th>Type</th>
          <th>Description</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-category>
        <tr>
          <td>{{ category.name }}</td>
          <td>
            <p-tag [value]="getTypeLabel(category.type)" [severity]="getTypeSeverity(category.type)"></p-tag>
          </td>
          <td>{{ category.description || '-' }}</td>
          <td>{{ category.isActive ? 'Active' : 'Inactive' }}</td>
          <td class="actions">
            <p-button icon="pi pi-pencil" severity="secondary" (onClick)="editCategory(category)"></p-button>
            <p-button icon="pi pi-trash" severity="danger" (onClick)="deleteCategory(category)"></p-button>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="5">Aucune catégorie trouvée.</td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>

<p-dialog [(visible)]="categoryDialog" [modal]="true" [style]="{ width: '520px' }" [header]="isEdit ? 'Modifier catégorie' : 'Nouvelle catégorie'">
  <div class="dialog-body">
    <div class="field">
      <label class="field-label">Nom</label>
      <input pInputText [(ngModel)]="categoryForm.name" class="w-full" />
    </div>
    <div class="field">
      <label class="field-label">Type</label>
      <p-select
        [options]="typeOptions"
        optionLabel="label"
        optionValue="value"
        [(ngModel)]="categoryForm.type"
        styleClass="w-full">
      </p-select>
    </div>
    <div class="field">
      <label class="field-label">Description</label>
      <input pInputText [(ngModel)]="categoryForm.description" class="w-full" />
    </div>
    <div class="field">
      <label class="field-label">Icône</label>
      <input pInputText [(ngModel)]="categoryForm.icon" class="w-full" />
    </div>
    <div class="field">
      <label class="field-label">Statut</label>
      <p-select
        [options]="[{ label: 'Active', value: true }, { label: 'Inactive', value: false }]"
        optionLabel="label"
        optionValue="value"
        [(ngModel)]="categoryForm.isActive"
        styleClass="w-full">
      </p-select>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <p-button label="Annuler" severity="secondary" (onClick)="categoryDialog = false"></p-button>
    <p-button label="Enregistrer" (onClick)="saveCategory()"></p-button>
  </ng-template>
</p-dialog>

<p-toast></p-toast>
